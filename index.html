import React, { useState, useEffect, useRef, useMemo } from 'react';
import { 
  Menu, X, ChevronDown, Check, ArrowRight, Shield, 
  Users, Layers, Zap, Hexagon, FileText, Download,
  Globe, Cpu, Server, Lock, ChevronRight, Plus
} from 'lucide-react';

/* ========================================
  1. CONTENT DATA (src/content/content.js)
  ========================================
*/
const CONTENT = {
  company: {
    name: "МИРМЕКС",
    tagline: "Интеллектуальная системная интеграция",
    intro: "Создаем надежную IT-инфраструктуру для бизнеса и госсектора. От аудита до пост-гарантийного обслуживания.",
    pdfUrl: "/mirmex-presentation.pdf"
  },
  nav: [
    { id: 'about', label: 'О компании' },
    { id: 'unique', label: 'Подход' },
    { id: 'services', label: 'Решения' },
    { id: 'reliability', label: 'Надежность' },
    { id: 'team', label: 'Команда' },
    { id: 'whyus', label: 'Факты' },
    { id: 'cases', label: 'Проекты' },
    { id: 'process', label: 'Этапы' },
    { id: 'tech', label: 'Вендоры' },
    { id: 'faq', label: 'FAQ' },
    { id: 'contacts', label: 'Контакты' },
  ],
  hero: {
    title: "IT-ИНФРАСТРУКТУРА БУДУЩЕГО",
    subtitle: "Комплексные решения: Сети, ЦОД, Информационная безопасность"
  },
  about: [
    { title: "Экспертиза", text: "Сертифицированные инженеры с опытом реализации федеральных проектов." },
    { title: "Мультивендорность", text: "Прямые партнерские статусы с ведущими мировыми и российскими производителями." },
    { title: "Ответственность", text: "Гарантируем работоспособность систем и соблюдение сроков по договору." }
  ],
  unique: [
    { title: "Импортозамещение", desc: "Глубокая экспертиза в миграции на отечественное ПО и оборудование (Реестр Минпромторга)." },
    { title: "Собственный склад", desc: "Оперативная подмена оборудования (Zzip), наличие запчастей для горячего ремонта." },
    { title: "SLA 24/7", desc: "Круглосуточная техническая поддержка и мониторинг критических узлов." },
    { title: "Комплексность", desc: "Единая точка входа: от прокладки СКС до настройки облачных сервисов." }
  ],
  services: [
    { title: "ЦОД и Вычисления", desc: "Серверные решения и СХД.", details: "Проектирование серверных комнат, поставка High-End серверов, All-Flash СХД, гиперконвергентные системы." },
    { title: "Сетевая инфраструктура", desc: "Корпоративные сети передачи данных.", details: "Ядро сети, коммутация, маршрутизация, Wi-Fi 6, SD-WAN, балансировка нагрузки." },
    { title: "Информационная безопасность", desc: "Защита периметра и данных.", details: "NGFW, DLP-системы, защита от DDoS, криптошлюзы, аудит безопасности (ФСТЭК/ФСБ)." },
    { title: "Мультимедиа и ВКС", desc: "Оснащение переговорных и залов.", details: "Видеоконференцсвязь, конгресс-системы, видеостены, интерактивные панели." },
    { title: "Виртуализация и VDI", desc: "Оптимизация IT-ландшафта.", details: "Частные и гибридные облака, VDI (удаленные рабочие столы), миграция с VMware." },
    { title: "Инженерные системы", desc: "СКС и электропитание.", details: "Структурированные кабельные сети, ИБП, системы кондиционирования и мониторинга среды." }
  ],
  reliability: [
    "Лицензии ФСТЭК/ФСБ", "ISO 9001:2015", "Допуски СРО", 
    "Страхование рисков", "Собственный демо-стенд", "Финансовая гарантия"
  ],
  team: {
    count: "120+",
    roles: ["Архитекторы решений", "Сетевые инженеры", "Инженеры ИБ", "Руководители проектов", "Сервисные инженеры", "Presale-эксперты"],
    schema: "Проектный офис"
  },
  whyUs: [
    { label: "Опыт", value: "15+", desc: "Лет успешной работы на рынке системной интеграции" },
    { label: "Проекты", value: "500+", desc: "Успешно реализованных внедрений различного масштаба" },
    { label: "Партнеры", value: "50+", desc: "Вендоров оборудования и программного обеспечения" }
  ],
  casesPublic: [
    {
      id: "case1",
      title: "Модернизация ЦОД Банка",
      task: "Обновление вычислительных мощностей без остановки сервисов",
      solutionBullets: ["Внедрение All-Flash массива Huawei", "Кластеризация серверов", "Миграция 200 ТБ данных"],
      resultMetrics: ["RPO/RTO ≈ 0", "Рост IOPS x10", "Tier III"]
    },
    {
      id: "case2",
      title: "Защищенная сеть Холдинга",
      task: "Объединение 40 филиалов в единую защищенную сеть (VPN)",
      solutionBullets: ["Внедрение NGFW Fortinet/UserGate", "Двухфакторная аутентификация", "Мониторинг SOC"],
      resultMetrics: ["100% защита", "Единый домен", "SLA 99.9%"]
    },
    {
      id: "case3",
      title: "Импортозамещение в Госсекторе",
      task: "Полный переход на отечественное ПО и АРМ",
      solutionBullets: ["ОС Astra Linux", "Платформа виртуализации РЕД", "Оборудование YADRO"],
      resultMetrics: ["2000+ АРМ", "Соответствие НПА", "Экономия 30%"]
    }
  ],
  casesNDA: [
    { title: "Федеральный ритейлер", industry: "Ритейл", result: "Wi-Fi аналитика и покрытие 500 точек" },
    { title: "Нефтеперерабатывающий завод", industry: "ТЭК", result: "Промышленный IoT и видеонаблюдение" },
    { title: "Логистический оператор", industry: "Логистика", result: "Модернизация СКС склада класса А+" },
    { title: "Медицинский центр", industry: "Здравоохранение", result: "Защита ПДн и интеграция МИС" }
  ],
  processSteps: [
    "IT-Аудит и обследование", "Проектирование (ТЗ/ПД)", "Поставка оборудования", 
    "Монтаж и ПНР", "Опытная эксплуатация", "Сервисная поддержка"
  ],
  techStack: [
    { cat: "Infrastructure", tools: "YADRO, Aquarius, Huawei, Dell, HPE, Lenovo" },
    { cat: "Networking", tools: "Cisco, Eltex, Juniper, Huawei, Aruba" },
    { cat: "Security", tools: "Kaspersky, Positive Tech, UserGate, Fortinet, CheckPoint" },
    { cat: "Software", tools: "Astra Linux, Microsoft, VMWare, Veaam, 1C" }
  ],
  faq: [
    { q: "Вы работаете с гособоронзаказом?", a: "Да, у нас есть необходимая экспертиза, лицензии и спецсчета для работы с ГОЗ и предприятиями ОПК." },
    { q: "Занимаетесь ли вы поставкой 'железа' без настройки?", a: "Да, мы осуществляем box-moving, однако наша ключевая ценность — это проектная дистрибьюция и интеграция 'под ключ'." },
    { q: "Как осуществляется техническая поддержка?", a: "Мы предлагаем различные уровни SLA: от 8x5 до 24x7 с временем реакции от 15 минут. Есть собственная первая линия поддержки." },
    { q: "Помогаете ли с миграцией на российские решения?", a: "Импортозамещение — одно из наших ключевых направлений. Мы подберем функциональные аналоги и проведем бесшовную миграцию." }
  ],
  contacts: {
    email: "sales@mirmex-it.ru",
    phone: "+7 (495) 000-00-00",
    telegram: "@mirmex_support",
    address: "Москва, Бизнес-центр 'Технопарк', оф. 305",
    formEndpoint: "https://api.mirmex-it.ru/leads" // Placeholder
  }
};

/* ========================================
  2. UTILS & HOOKS
  ========================================
*/

const useReducedMotion = () => {
  const [matches, setMatches] = useState(false);
  useEffect(() => {
    const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');
    setMatches(mediaQuery.matches);
    const handler = (e) => setMatches(e.matches);
    mediaQuery.addEventListener('change', handler);
    return () => mediaQuery.removeEventListener('change', handler);
  }, []);
  return matches;
};

// Hook for scroll animations (Intersection Observer)
// Threshold 0.3 means animation starts when 30% of element is visible
const useScrollReveal = (threshold = 0.3, rootMargin = "0px") => {
  const [isVisible, setIsVisible] = useState(false);
  const ref = useRef(null);
  const reduceMotion = useReducedMotion();

  useEffect(() => {
    if (reduceMotion) {
      setIsVisible(true);
      return;
    }
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsVisible(true);
          observer.unobserve(entry.target);
        }
      },
      { threshold, rootMargin }
    );
    if (ref.current) observer.observe(ref.current);
    return () => {
      if (ref.current) observer.unobserve(ref.current);
    };
  }, [threshold, rootMargin, reduceMotion]);

  return [ref, isVisible];
};

/* ========================================
  3. UI COMPONENTS
  ========================================
*/

const Button = ({ children, variant = 'primary', className = '', ...props }) => {
  const baseClass = "inline-flex items-center justify-center px-8 py-3 text-sm font-medium tracking-widest uppercase transition-all duration-300 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed";
  
  const variants = {
    primary: "bg-blue-600 hover:bg-blue-700 text-white border border-transparent shadow-lg shadow-blue-500/20",
    outline: "bg-transparent border border-zinc-300 text-zinc-600 hover:border-blue-500 hover:text-blue-600 hover:bg-blue-50",
    text: "bg-transparent text-zinc-500 hover:text-blue-600 px-4"
  };

  return (
    <button className={`${baseClass} ${variants[variant]} ${className}`} {...props}>
      {children}
    </button>
  );
};

const SectionHeader = ({ title, subtitle }) => {
  const [ref, isVisible] = useScrollReveal();
  
  return (
    <div ref={ref} className={`mb-16 transition-all duration-1000 ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-10'}`}>
      <h2 className="text-3xl md:text-5xl font-light text-zinc-900 tracking-tight mb-4">
        <span className="text-blue-600 font-bold mr-2">/</span>
        {title}
      </h2>
      {subtitle && <div className="h-px w-24 bg-zinc-200 mt-6" />}
    </div>
  );
};

const Modal = ({ isOpen, onClose, title, children }) => {
  if (!isOpen) return null;
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div className="absolute inset-0 bg-zinc-900/40 backdrop-blur-sm" onClick={onClose} />
      <div className="relative bg-white border border-zinc-200 w-full max-w-2xl max-h-[90vh] overflow-y-auto p-8 shadow-2xl">
        <button onClick={onClose} className="absolute top-4 right-4 text-zinc-400 hover:text-zinc-900">
          <X size={24} />
        </button>
        <h3 className="text-2xl font-light text-zinc-900 mb-6 border-b border-zinc-100 pb-4">{title}</h3>
        {children}
      </div>
    </div>
  );
};

/* ========================================
  4. MAIN SECTIONS
  ========================================
*/

const Hero = () => {
  const [mounted, setMounted] = useState(false);
  useEffect(() => setMounted(true), []);

  return (
    <section id="hero" className="relative h-screen min-h-[600px] flex items-center justify-center overflow-hidden bg-white">
      {/* Background Grid Animation (Light Mode) */}
      <div className="absolute inset-0 bg-[linear-gradient(to_right,#e4e4e7_1px,transparent_1px),linear-gradient(to_bottom,#e4e4e7_1px,transparent_1px)] bg-[size:4rem_4rem] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_50%,#000_70%,transparent_100%)] pointer-events-none" />
      
      <div className="relative z-10 container mx-auto px-6 text-center">
        <div className={`transition-all duration-1000 delay-300 ${mounted ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-10'}`}>
          <div className="inline-block border border-blue-500/30 text-blue-600 px-3 py-1 text-xs tracking-[0.2em] mb-6 bg-blue-50">
            SYSTEM INTEGRATOR
          </div>
          <h1 className="text-5xl md:text-7xl lg:text-9xl font-bold text-zinc-900 tracking-tighter mb-6">
            {CONTENT.hero.title}
          </h1>
          <p className="text-zinc-500 text-lg md:text-xl max-w-2xl mx-auto mb-12 font-light leading-relaxed">
            {CONTENT.hero.subtitle}
          </p>
          
          <div className="flex flex-col md:flex-row gap-4 justify-center items-center">
            <Button onClick={() => document.getElementById('contacts').scrollIntoView({ behavior: 'smooth' })}>
              Получить консультацию
            </Button>
            <Button variant="outline" className="group">
              <Download className="mr-2 w-4 h-4 group-hover:animate-bounce" />
              Презентация (PDF)
            </Button>
          </div>
        </div>
      </div>

      {/* Blueprint Lines Decoration */}
      <svg className="absolute inset-0 w-full h-full pointer-events-none opacity-30" xmlns="http://www.w3.org/2000/svg">
        <line x1="0" y1="50%" x2="100%" y2="50%" stroke="#3b82f6" strokeWidth="1" strokeDasharray="4 4" className={mounted ? "animate-draw-line" : "opacity-0"} />
        <line x1="50%" y1="0" x2="50%" y2="100%" stroke="#3b82f6" strokeWidth="1" strokeDasharray="4 4" className={mounted ? "animate-draw-line-v" : "opacity-0"} />
      </svg>
      
      <div className="absolute bottom-10 left-1/2 -translate-x-1/2 animate-bounce text-zinc-400">
        <ChevronDown size={24} />
      </div>
    </section>
  );
};

const Card = ({ title, desc, children, delay = 0, onClick }) => {
  const [ref, isVisible] = useScrollReveal(0.2);
  
  return (
    <div 
      ref={ref}
      onClick={onClick}
      style={{ transitionDelay: `${delay}ms` }}
      className={`
        group relative p-8 border border-zinc-200 bg-white 
        transition-all duration-700 hover:border-blue-500/50 hover:shadow-xl hover:shadow-blue-500/5
        ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-8'}
        ${onClick ? 'cursor-pointer' : ''}
      `}
    >
      <div className="absolute top-0 right-0 w-3 h-3 border-t border-r border-zinc-300 group-hover:border-blue-500 transition-colors" />
      <div className="absolute bottom-0 left-0 w-3 h-3 border-b border-l border-zinc-300 group-hover:border-blue-500 transition-colors" />
      
      {children && <div className="mb-6 text-blue-600">{children}</div>}
      <h3 className="text-xl font-bold text-zinc-900 mb-3">{title}</h3>
      <p className="text-zinc-500 text-sm leading-relaxed">{desc}</p>
    </div>
  );
};

const Services = () => {
  const [selectedService, setSelectedService] = useState(null);

  return (
    <section id="services" className="min-h-screen py-24 bg-zinc-50 border-t border-zinc-200 flex flex-col justify-center">
      <div className="container mx-auto px-6">
        <SectionHeader title="РЕШЕНИЯ" />
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {CONTENT.services.map((s, i) => (
            <Card 
              key={i} 
              title={s.title} 
              desc={s.desc} 
              delay={i * 100}
              onClick={() => setSelectedService(s)}
            >
              <Layers size={32} strokeWidth={1} />
            </Card>
          ))}
        </div>
      </div>
      
      <Modal isOpen={!!selectedService} onClose={() => setSelectedService(null)} title={selectedService?.title}>
        <p className="text-zinc-600 mb-6">{selectedService?.desc}</p>
        <div className="bg-zinc-50 p-4 border border-zinc-200">
          <h4 className="text-sm font-bold text-blue-600 uppercase tracking-wider mb-2">Технические детали</h4>
          <p className="text-zinc-700 font-light">{selectedService?.details}</p>
        </div>
        <div className="mt-8 flex justify-end">
          <Button variant="outline" onClick={() => setSelectedService(null)}>Закрыть</Button>
        </div>
      </Modal>
    </section>
  );
};

const Cases = () => {
  const [showNDA, setShowNDA] = useState(false);
  const [ref, isVisible] = useScrollReveal();

  return (
    <section id="cases" className="min-h-screen py-24 bg-white relative flex flex-col justify-center">
      <div className="container mx-auto px-6">
        <SectionHeader title="ПРОЕКТЫ" />
        
        <div className="space-y-24">
          {CONTENT.casesPublic.map((c, i) => (
            <div key={c.id} id={c.id} className="grid md:grid-cols-12 gap-12 border-l border-zinc-200 pl-8 md:pl-12 relative">
               <div className="absolute left-[-1px] top-0 w-[1px] h-24 bg-blue-600" />
               
               <div className="md:col-span-4">
                 <div className="text-8xl font-bold text-zinc-100 absolute -top-10 -left-6 z-[-1] select-none">0{i+1}</div>
                 <h3 className="text-3xl text-zinc-900 font-bold mb-4">{c.title}</h3>
                 <p className="text-blue-600 mb-2 font-mono text-sm">{c.task}</p>
               </div>
               
               <div className="md:col-span-4">
                 <h4 className="text-sm text-zinc-400 uppercase tracking-widest mb-4">Решение</h4>
                 <ul className="space-y-2">
                   {c.solutionBullets.map((bullet, idx) => (
                     <li key={idx} className="flex items-start text-zinc-600 text-sm">
                       <Check size={14} className="mr-2 mt-1 text-blue-600 shrink-0" />
                       {bullet}
                     </li>
                   ))}
                 </ul>
               </div>

               <div className="md:col-span-4">
                 <h4 className="text-sm text-zinc-400 uppercase tracking-widest mb-4">Результат</h4>
                 <div className="grid grid-cols-1 gap-4">
                   {c.resultMetrics.map((m, idx) => (
                     <div key={idx} className="bg-zinc-50 border border-zinc-200 p-3">
                       <span className="text-zinc-800 font-mono">{m}</span>
                     </div>
                   ))}
                 </div>
               </div>
            </div>
          ))}
        </div>

        <div className="mt-24 text-center">
          <Button variant="outline" onClick={() => setShowNDA(true)}>
            <Lock size={16} className="mr-2" />
            Показать архив проектов
          </Button>
        </div>
      </div>

      <Modal isOpen={showNDA} onClose={() => setShowNDA(false)} title="Архив внедрений">
        <div className="grid gap-4">
          {CONTENT.casesNDA.map((n, i) => (
            <div key={i} className="flex justify-between items-center p-4 border border-zinc-200 hover:bg-zinc-50 transition-colors">
              <div>
                <h4 className="text-zinc-900 font-bold">{n.title}</h4>
                <p className="text-xs text-zinc-500 uppercase">{n.industry}</p>
              </div>
              <div className="text-right">
                <p className="text-zinc-600 text-sm">{n.result}</p>
              </div>
            </div>
          ))}
        </div>
        <p className="mt-6 text-xs text-zinc-500 text-center">
          * Подробности доступны только при личной встрече после подписания NDA.
        </p>
      </Modal>
    </section>
  );
};

const Process = () => {
  const [ref, isVisible] = useScrollReveal();
  
  return (
    <section id="process" className="min-h-screen py-24 bg-zinc-50 overflow-hidden flex flex-col justify-center">
      <div className="container mx-auto px-6">
        <SectionHeader title="ЭТАПЫ РАБОТЫ" />
        <div ref={ref} className="relative mt-20">
          {/* Central Line */}
          <div className={`absolute left-4 md:left-1/2 top-0 bottom-0 w-px bg-zinc-300 transition-all duration-[1.5s] origin-top ${isVisible ? 'scale-y-100' : 'scale-y-0'}`} />
          
          <div className="space-y-12">
            {CONTENT.processSteps.map((step, i) => (
              <div key={i} className={`flex flex-col md:flex-row items-center ${i % 2 === 0 ? 'md:flex-row-reverse' : ''} group`}>
                <div className="flex-1 hidden md:block" />
                
                <div className="relative z-10 w-8 h-8 rounded-full bg-white border border-zinc-300 flex items-center justify-center text-xs text-zinc-500 group-hover:border-blue-500 group-hover:text-blue-500 transition-colors duration-500 shrink-0 mx-4 self-start md:self-center">
                  {i + 1}
                </div>
                
                <div className="flex-1 pl-4 md:pl-0 md:px-12 w-full">
                  <div className={`p-6 border border-zinc-200 bg-white transition-all duration-500 hover:translate-x-2 shadow-sm ${i % 2 === 0 ? 'md:text-right' : 'md:text-left'}`}>
                    <h4 className="text-lg text-zinc-900 font-medium">{step}</h4>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </section>
  );
};

const Contacts = () => {
  const [formState, setFormState] = useState({ status: 'idle', msg: '' });
  
  const handleSubmit = (e) => {
    e.preventDefault();
    setFormState({ status: 'loading', msg: '' });
    
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);
    
    // Honeypot check
    if (data._hp) {
      setFormState({ status: 'error', msg: 'Spam detected' });
      return;
    }

    // Simulation
    setTimeout(() => {
      setFormState({ status: 'success', msg: 'Заявка принята. Менеджер свяжется с вами в течение часа.' });
      e.target.reset();
    }, 1500);
  };

  return (
    <section id="contacts" className="min-h-screen py-24 bg-white border-t border-zinc-200 flex flex-col justify-center relative">
      <div className="container mx-auto px-6 z-10">
        <SectionHeader title="КОНТАКТЫ" />
        
        <div className="grid lg:grid-cols-2 gap-16">
          <div>
            <div className="space-y-8 mb-12">
              <div className="flex items-start">
                <div className="w-12 h-12 bg-zinc-50 flex items-center justify-center mr-6 border border-zinc-200">
                  <ArrowRight className="text-blue-600" />
                </div>
                <div>
                  <h4 className="text-zinc-400 text-xs uppercase tracking-widest mb-1">Email</h4>
                  <a href={`mailto:${CONTENT.contacts.email}`} className="text-2xl text-zinc-900 hover:text-blue-600 transition-colors">
                    {CONTENT.contacts.email}
                  </a>
                </div>
              </div>
              
              <div className="flex items-start">
                <div className="w-12 h-12 bg-zinc-50 flex items-center justify-center mr-6 border border-zinc-200">
                  <ArrowRight className="text-blue-600" />
                </div>
                <div>
                  <h4 className="text-zinc-400 text-xs uppercase tracking-widest mb-1">Telegram</h4>
                  <a href="#" className="text-xl text-zinc-900 hover:text-blue-600 transition-colors">
                    {CONTENT.contacts.telegram}
                  </a>
                </div>
              </div>

              <div className="flex items-start">
                 <div className="w-12 h-12 bg-zinc-50 flex items-center justify-center mr-6 border border-zinc-200">
                  <ArrowRight className="text-blue-600" />
                </div>
                <div>
                  <h4 className="text-zinc-400 text-xs uppercase tracking-widest mb-1">Офис</h4>
                  <p className="text-zinc-600">{CONTENT.contacts.address}</p>
                </div>
              </div>
            </div>
            
            <div className="p-6 border border-zinc-200 bg-zinc-50">
              <h5 className="text-zinc-900 font-bold mb-2">Реквизиты</h5>
              <p className="text-zinc-500 text-sm font-mono">
                ООО "МИРМЕКС"<br/>
                ИНН: 7700000000<br/>
                КПП: 770101001
              </p>
            </div>
          </div>

          <form onSubmit={handleSubmit} className="space-y-6">
            <input type="text" name="_hp" className="hidden" /> {/* Honeypot */}
            
            <div className="grid grid-cols-2 gap-6">
              <div className="space-y-2">
                <label className="text-xs text-zinc-500 uppercase">Ваше Имя</label>
                <input required type="text" name="name" className="w-full bg-zinc-50 border border-zinc-200 p-4 text-zinc-900 focus:border-blue-500 focus:outline-none transition-colors" placeholder="Иван Иванов" />
              </div>
              <div className="space-y-2">
                <label className="text-xs text-zinc-500 uppercase">Организация</label>
                <input type="text" name="company" className="w-full bg-zinc-50 border border-zinc-200 p-4 text-zinc-900 focus:border-blue-500 focus:outline-none transition-colors" placeholder="ООО Вектор" />
              </div>
            </div>

            <div className="space-y-2">
              <label className="text-xs text-zinc-500 uppercase">Контакт (Tlg/Phone)</label>
              <input required type="text" name="contact" className="w-full bg-zinc-50 border border-zinc-200 p-4 text-zinc-900 focus:border-blue-500 focus:outline-none transition-colors" placeholder="+7 (999) ..." />
            </div>

            <div className="space-y-2">
              <label className="text-xs text-zinc-500 uppercase">Описание задачи</label>
              <textarea required name="message" rows={4} className="w-full bg-zinc-50 border border-zinc-200 p-4 text-zinc-900 focus:border-blue-500 focus:outline-none transition-colors" placeholder="Например: Модернизация серверной..." />
            </div>

            <Button disabled={formState.status === 'loading'} className="w-full">
              {formState.status === 'loading' ? 'Отправка...' : 'Отправить запрос'}
            </Button>

            {formState.status === 'success' && (
              <div className="p-4 bg-green-50 border border-green-200 text-green-700 text-sm text-center">
                {formState.msg}
              </div>
            )}
            {formState.status === 'error' && (
              <div className="p-4 bg-red-50 border border-red-200 text-red-700 text-sm text-center">
                {formState.msg}
              </div>
            )}
            
            <p className="text-xs text-zinc-500 text-center">
              Нажимая кнопку, вы соглашаетесь с политикой обработки персональных данных.
            </p>
          </form>
        </div>
      </div>
      
      <footer className="absolute bottom-0 left-0 right-0 py-6 text-center text-zinc-400 text-xs uppercase tracking-widest bg-zinc-50 border-t border-zinc-200">
        © {new Date().getFullYear()} {CONTENT.company.name}. Все права защищены.
      </footer>
    </section>
  );
};

/* ========================================
  5. LAYOUT & NAVIGATION
  ========================================
*/

const NavigationRail = () => {
  const [activeId, setActiveId] = useState('hero');

  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            setActiveId(entry.target.id);
          }
        });
      },
      { threshold: 0.3 }
    );

    document.querySelectorAll('section[id]').forEach((section) => {
      observer.observe(section);
    });

    return () => observer.disconnect();
  }, []);

  const scrollTo = (id) => {
    document.getElementById(id)?.scrollIntoView({ behavior: 'smooth' });
  };

  return (
    <div className="fixed right-3 top-1/2 -translate-y-1/2 z-40 hidden lg:flex flex-col items-center gap-4">
      {CONTENT.nav.map((item) => (
        <button
          key={item.id}
          onClick={() => scrollTo(item.id)}
          className="group flex items-center justify-end relative"
          aria-label={`Go to ${item.label}`}
        >
          <span className={`absolute right-6 text-xs uppercase tracking-widest text-zinc-900 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap bg-white/90 border border-zinc-200 px-2 py-1 shadow-sm`}>
            {item.label}
          </span>
          <div 
            className={`w-1 transition-all duration-300 ${
              activeId === item.id ? 'h-8 bg-blue-600' : 'h-2 bg-zinc-300 hover:bg-zinc-400'
            }`} 
          />
        </button>
      ))}
    </div>
  );
};

const Header = () => {
  const [isMenuOpen, setIsMenuOpen] = useState(false);

  const scrollTo = (id) => {
    setIsMenuOpen(false);
    document.getElementById(id)?.scrollIntoView({ behavior: 'smooth' });
  };

  const headerHiddenItems = ['unique', 'whyus', 'process', 'tech', 'contacts'];

  return (
    <header className="fixed top-0 left-0 right-0 z-50 border-b border-zinc-200 bg-white py-4">
      <div className="container mx-auto px-6 flex justify-between items-center">
        <div className="flex items-center gap-3 cursor-pointer" onClick={() => scrollTo('hero')}>
          <div className="w-8 h-8 bg-blue-600 flex items-center justify-center">
             <Hexagon size={16} className="text-white" fill="white" />
          </div>
          <span className="text-xl font-bold text-zinc-900 tracking-widest">{CONTENT.company.name}</span>
        </div>

        {/* Desktop Nav */}
        <nav className="hidden md:flex items-center gap-8">
          {CONTENT.nav
            .filter(item => !headerHiddenItems.includes(item.id))
            .map(item => (
              <button key={item.id} onClick={() => scrollTo(item.id)} className="text-sm uppercase text-zinc-500 hover:text-blue-600 transition-colors tracking-widest font-medium">
                {item.label}
              </button>
            ))
          }
          <Button 
            variant="primary" 
            onClick={() => scrollTo('contacts')} 
            className="!px-6 relative overflow-hidden group"
          >
            <span className="relative z-10">Связаться</span>
            <div className="absolute top-0 -left-[100%] w-full h-full bg-gradient-to-r from-transparent via-white/20 to-transparent skew-x-[-20deg] animate-shine" />
          </Button>
        </nav>

        {/* Mobile Menu Toggle */}
        <button className="md:hidden text-zinc-900" onClick={() => setIsMenuOpen(!isMenuOpen)}>
          {isMenuOpen ? <X /> : <Menu />}
        </button>
      </div>

      {/* Mobile Menu */}
      {isMenuOpen && (
        <div className="absolute top-full left-0 right-0 bg-white border-b border-zinc-200 p-6 md:hidden flex flex-col gap-6 shadow-2xl">
           {CONTENT.nav.map(item => (
            <button key={item.id} onClick={() => scrollTo(item.id)} className="text-left text-lg text-zinc-900 font-medium">
              {item.label}
            </button>
          ))}
        </div>
      )}
    </header>
  );
};

/* ========================================
  6. APP ENTRY POINT
  ========================================
*/

export default function App() {
  // Custom Smooth Snap Logic (30% threshold)
  useEffect(() => {
    // Only run on desktop/large screens (and tablets in landscape)
    if (window.innerWidth < 768) return;

    let isScrolling;
    let lastScrollY = window.scrollY;

    const handleScrollSnap = () => {
      window.clearTimeout(isScrolling);
      
      const currentScrollY = window.scrollY;
      const viewportHeight = window.innerHeight;
      const direction = currentScrollY > lastScrollY ? 'down' : 'up';
      lastScrollY = currentScrollY;

      // Skip snapping if scrolling up (allow natural scroll)
      if (direction === 'up') return;

      // Debounce snapping until scrolling stops
      isScrolling = setTimeout(() => {
        const sections = Array.from(document.querySelectorAll('section'));
        
        // Find the next section we are approaching
        const nextSection = sections.find(s => s.offsetTop > currentScrollY + 10);
        
        if (nextSection) {
            const distanceToNext = nextSection.offsetTop - currentScrollY;
            const visiblePart = viewportHeight - distanceToNext;
            const threshold = viewportHeight * 0.3; // 30%

            if (visiblePart > threshold) {
                // Snap to next
                window.scrollTo({
                    top: nextSection.offsetTop,
                    behavior: 'smooth'
                });
            } else {
                // Snap back logic removed to prevent jumping back to current section top 
                // if we are in the middle of a tall section.
                // However, we might want to check if current section is short.
                // For now, only snapping forward is safer for tall content.
                const currentIndex = sections.indexOf(nextSection) - 1;
                if (currentIndex >= 0) {
                    const currentSection = sections[currentIndex];
                    // Only snap back if the current section fits in the viewport
                    if (currentSection.offsetHeight < viewportHeight * 1.2) {
                         window.scrollTo({
                            top: currentSection.offsetTop,
                            behavior: 'smooth'
                        });
                    }
                }
            }
        }
      }, 50); // 50ms delay
    };

    window.addEventListener('scroll', handleScrollSnap);
    return () => window.removeEventListener('scroll', handleScrollSnap);
  }, []);

  return (
    <div className="min-h-screen bg-white text-zinc-800 font-sans selection:bg-blue-100 selection:text-blue-900 overflow-x-hidden">
      <Header />
      <NavigationRail />
      
      {/* Removed CSS snap classes (lg:snap-y lg:snap-mandatory) to allow JS control */}
      <main className="scroll-smooth">
        <Hero />
        
        <section id="about" className="min-h-screen py-24 bg-zinc-50 flex flex-col justify-center border-t border-zinc-200">
          <div className="container mx-auto px-6">
            <SectionHeader title="О КОМПАНИИ" />
            <div className="grid md:grid-cols-3 gap-12">
              {CONTENT.about.map((item, i) => (
                <div key={i} className="border-t border-zinc-300 pt-6">
                   <h3 className="text-2xl text-zinc-900 font-bold mb-4">{item.title}</h3>
                   <p className="text-zinc-600 leading-relaxed">{item.text}</p>
                </div>
              ))}
            </div>
          </div>
        </section>

        <section id="unique" className="min-h-screen py-24 bg-white flex flex-col justify-center border-t border-zinc-200">
          <div className="container mx-auto px-6">
            <SectionHeader title="ПОДХОД" />
            <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
              {CONTENT.unique.map((u, i) => (
                <Card key={i} title={u.title} desc={u.desc} delay={i*100}>
                   <Shield size={24} />
                </Card>
              ))}
            </div>
          </div>
        </section>

        <Services />
        
        <section id="reliability" className="min-h-screen py-24 bg-white flex flex-col justify-center border-t border-zinc-200">
          <div className="container mx-auto px-6">
            <SectionHeader title="НАДЕЖНОСТЬ" />
            <div className="grid grid-cols-2 md:grid-cols-3 gap-px bg-zinc-200 border border-zinc-200">
               {CONTENT.reliability.map((item, i) => (
                 <div key={i} className="bg-white p-8 flex items-center justify-center text-center hover:bg-blue-50 transition-colors">
                   <span className="text-zinc-600 font-medium">{item}</span>
                 </div>
               ))}
            </div>
          </div>
        </section>

        <section id="team" className="min-h-screen py-24 bg-zinc-50 flex flex-col justify-center border-t border-zinc-200">
           <div className="container mx-auto px-6">
            <SectionHeader title="КОМАНДА" />
            <div className="flex flex-col md:flex-row gap-12 items-center">
              <div className="flex-1">
                <div className="text-9xl font-bold text-zinc-200 leading-none">{CONTENT.team.count}</div>
                <p className="text-xl text-zinc-900 mt-4 font-light">Штатных инженеров</p>
                <p className="text-zinc-500 mt-2">{CONTENT.team.schema}</p>
              </div>
              <div className="flex-1 grid grid-cols-2 gap-4">
                {CONTENT.team.roles.map((role, i) => (
                   <div key={i} className="flex items-center gap-3 text-zinc-600">
                     <div className="w-1.5 h-1.5 bg-blue-600 rounded-full" />
                     {role}
                   </div>
                ))}
              </div>
            </div>
           </div>
        </section>
        
        <section id="whyus" className="min-h-screen py-24 bg-white flex flex-col justify-center border-t border-zinc-200">
          <div className="container mx-auto px-6">
             <div className="grid md:grid-cols-3 divide-y md:divide-y-0 md:divide-x divide-zinc-200 border-y border-zinc-200">
                {CONTENT.whyUs.map((w, i) => (
                  <div key={i} className="p-12 text-center group hover:bg-zinc-50 transition-colors">
                    <div className="text-xs text-zinc-400 uppercase tracking-widest mb-2">{w.label}</div>
                    <div className="text-4xl font-bold text-zinc-900 mb-4 group-hover:text-blue-600 transition-colors">{w.value}</div>
                    <p className="text-zinc-500 text-sm">{w.desc}</p>
                  </div>
                ))}
             </div>
          </div>
        </section>

        <Cases />
        <Process />

        <section id="tech" className="min-h-screen py-24 bg-white flex flex-col justify-center border-t border-zinc-200">
          <div className="container mx-auto px-6">
            <SectionHeader title="ВЕНДОРЫ" />
            <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
               {CONTENT.techStack.map((t, i) => (
                 <div key={i}>
                   <h4 className="text-zinc-900 font-bold mb-4 border-b border-zinc-200 pb-2">{t.cat}</h4>
                   <p className="text-zinc-600 font-mono text-sm">{t.tools}</p>
                 </div>
               ))}
            </div>
          </div>
        </section>
        
        <section id="faq" className="min-h-screen py-24 bg-zinc-50 flex flex-col justify-center border-t border-zinc-200">
          <div className="container mx-auto px-6 max-w-4xl">
             <SectionHeader title="FAQ" />
             <div className="space-y-4">
               {CONTENT.faq.map((f, i) => (
                 <details key={i} className="group border border-zinc-200 bg-white open:border-blue-500 transition-colors">
                   <summary className="flex justify-between items-center p-6 cursor-pointer list-none text-zinc-900 font-medium hover:text-blue-600 transition-colors">
                     {f.q}
                     <Plus className="group-open:rotate-45 transition-transform text-zinc-400" />
                   </summary>
                   <div className="px-6 pb-6 text-zinc-600 text-sm leading-relaxed border-t border-zinc-100 pt-4">
                     {f.a}
                   </div>
                 </details>
               ))}
             </div>
          </div>
        </section>

        <Contacts />
      </main>

      <style>{`
        @keyframes draw-line {
          to { stroke-dashoffset: 0; }
        }
        .animate-draw-line {
          stroke-dasharray: 1000;
          stroke-dashoffset: 1000;
          animation: draw-line 2s ease-out forwards;
        }
        .animate-draw-line-v {
          stroke-dasharray: 1000;
          stroke-dashoffset: 1000;
          animation: draw-line 2s ease-out 0.5s forwards;
        }
        @keyframes shine {
          0% { left: -100%; }
          20% { left: 200%; }
          100% { left: 200%; }
        }
        .animate-shine {
          animation: shine 3s infinite;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { bg: #f4f4f5; }
        ::-webkit-scrollbar-thumb { background: #d4d4d8; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #3b82f6; }
      `}</style>
    </div>
  );
}
